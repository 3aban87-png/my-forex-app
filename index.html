<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EXPONENTIAL TERMINAL PRO</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #050810; --card: rgba(30, 41, 59, 0.6); --blue: #3b82f6; --green: #10b981; --red: #ef4444; --text: #f8fafc; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: sans-serif; overflow-x: hidden; }
        .glass { background: var(--card); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; margin: 10px; padding: 15px; }
        
        /* Ù‡Ø¯Ø± */
        .top-bar { display: flex; justify-content: space-between; align-items: center; }
        .total-box { flex-grow: 1; text-align: center; background: rgba(59, 130, 246, 0.1); padding: 10px; border-radius: 12px; margin-left: 10px; border: 1px solid var(--blue); }
        
        /* Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø³ÛŒÚ¯Ù†Ø§Ù„ */
        .signal-card { position: relative; border-right: 4px solid var(--blue); margin-bottom: 10px; }
        .pnl-badge { position: absolute; left: 15px; top: 15px; font-size: 18px; font-weight: bold; }
        .sltp-box { display: flex; gap: 15px; margin-top: 10px; font-size: 12px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 8px; }

        /* Ù†Ø§ÙˆØ¨Ø±ÛŒ Ù¾Ø§ÛŒÛŒÙ† */
        .nav-container { position: fixed; bottom: 0; left: 0; right: 0; background: #0f172a; display: flex; padding: 10px 0; border-top: 1px solid #334155; z-index: 1000; }
        .nav-item { flex: 1; background: none; border: none; color: #64748b; display: flex; flex-direction: column; align-items: center; font-size: 11px; cursor: pointer; }
        .nav-item.active { color: var(--blue); }

        .page { display: none; padding: 10px; padding-bottom: 100px; }
        .active-page { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .news-item { border-left: 3px solid var(--blue); padding: 12px; margin-bottom: 10px; font-size: 13px; line-height: 1.6; }
    </style>
</head>
<body>

    <div class="top-bar glass">
        <div class="total-box">
            <small style="color:#94a3b8">Ø¨Ø±Ø¢ÛŒÙ†Ø¯ Ú©Ù„ (Pip)</small><br>
            <b id="total" style="font-size: 26px;">0</b>
        </div>
        <button onclick="tab('p-history')" style="background:var(--card); border:1px solid #444; color:white; border-radius:10px; padding:10px 15px; cursor:pointer;">ðŸ“œ ØªØ§Ø±ÛŒØ®Ú†Ù‡</button>
    </div>

    <div id="p-signals" class="page active-page">
        <div id="list-sig"></div>
    </div>

    <div id="p-news" class="page">
        <h3 style="margin:15px">ðŸ“¢ Ø§Ø®Ø¨Ø§Ø± Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ø¨Ø§Ø²Ø§Ø±</h3>
        <div id="list-news"></div>
    </div>

    <div id="p-history" class="page">
        <h3 style="margin:15px">ðŸ“œ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3>
        <div id="list-hist" class="glass"></div>
    </div>

    <div id="p-calc" class="page">
        <h3 style="margin:15px">ðŸ§® Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¬Ù…</h3>
        <div class="glass">
            <input type="number" id="bal" placeholder="Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø­Ø³Ø§Ø¨ ($)" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px; border:none; background:#000; color:#fff;">
            <input type="number" id="sl_p" placeholder="Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ (Ù¾ÛŒÙ¾)" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px; border:none; background:#000; color:#fff;">
            <button onclick="calcLot()" style="width:100%; padding:15px; background:var(--green); color:white; border:none; border-radius:8px; font-weight:bold;">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
            <h2 id="res" style="text-align:center; color:var(--green)"></h2>
        </div>
    </div>

    <nav class="nav-container">
        <button class="nav-item active" onclick="tab('p-signals', this)"><span>ðŸ“ˆ Ø³ÛŒÚ¯Ù†Ø§Ù„</span></button>
        <button class="nav-item" onclick="tab('p-news', this)"><span>ðŸ“¢ Ø§Ø®Ø¨Ø§Ø±</span></button>
        <button class="nav-item" onclick="tab('p-calc', this)"><span>ðŸ§® Ù…Ø­Ø§Ø³Ø¨Ù‡</span></button>
        <button class="nav-item" onclick="openSupport()"><span>ðŸŽ§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</span></button>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // Ø¢Ø¯Ø±Ø³ Ngrok Ø´Ù…Ø§ (Ø¨Ø§ÛŒØ¯ Ø¨Ø§ Ø¢Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø´ÙˆØ¯)
        const API = "https://unparried-jack-multipolar.ngrok-free.dev"; 

        function tab(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active-page');
            if(el && el.classList.contains('nav-item')) el.classList.add('active');
        }

        function openSupport() { tg.openTelegramLink('https://t.me/your_admin'); }

        function calcLot() {
            const b = document.getElementById('bal').value;
            const s = document.getElementById('sl_p').value;
            if(b && s) {
                const r = (b * 0.01) / (s * 10);
                document.getElementById('res').innerText = r.toFixed(2) + " Lot";
            }
        }

        async function refresh() {
            try {
                const res = await fetch(`${API}/api/v1/status`);
                const data = await res.json();
                
                document.getElementById('total').innerText = Math.round(data.total_pips);

                let sigHtml = '';
                data.active_signals.forEach(s => {
                    const color = s.current_pips >= 0 ? 'var(--green)' : 'var(--red)';
                    sigHtml += `
                        <div class="glass signal-card" style="border-right-color:${s.type=='BUY'? 'var(--green)':'var(--red)'}">
                            <div class="pnl-badge" style="color:${color}">${Math.round(s.current_pips)} P</div>
                            <b style="font-size:18px">${s.symbol}</b> <small style="color:${s.type=='BUY'?'var(--green)':'var(--red)'}">${s.type}</small><br>
                            <small style="opacity:0.6">ÙˆØ±ÙˆØ¯: ${s.entry} | Ø²Ù…Ø§Ù†: ${s.time}</small>
                            <div class="sltp-box">
                                <span style="color:var(--red)">SL: ${s.sl}</span>
                                <span style="color:var(--green)">TP: ${s.tp}</span>
                            </div>
                        </div>`;
                });
                document.getElementById('list-sig').innerHTML = sigHtml || '<center style="opacity:0.5; margin-top:50px">Ø³ÛŒÚ¯Ù†Ø§Ù„ÛŒ Ø¨Ø§Ø² Ù†ÛŒØ³Øª</center>';
                
                let newsHtml = '';
                data.news.forEach(n => {
                    newsHtml += `<div class="glass news-item"><small style="color:var(--blue)">${n.time}</small><br>${n.title}</div>`;
                });
                document.getElementById('list-news').innerHTML = newsHtml;

            } catch(e) { console.error("Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ± Ø¨Ø±Ù‚Ø±Ø§Ø± Ù†Ø´Ø¯"); }
        }

        setInterval(refresh, 2500);
        refresh();
    </script>
</body>
</html>
