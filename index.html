<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EXPONENTIAL PRO TERMINAL</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #050810; --card: rgba(30, 41, 59, 0.5); --blue: #3b82f6; --green: #10b981; --red: #ef4444; --text: #f8fafc; }
        body { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: Tahoma, sans-serif; overflow-x: hidden; }
        .glass { background: var(--card); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; }
        
        /* Ù‡Ø¯Ø± Ø¨Ø§ Ø¨Ø±Ø¢ÛŒÙ†Ø¯ Ùˆ Ø¯Ú©Ù…Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡ */
        .top-bar { display: flex; justify-content: space-between; align-items: center; padding: 15px; margin: 10px; }
        .total-box { flex-grow: 1; text-align: center; background: rgba(59, 130, 246, 0.1); padding: 10px; border-radius: 12px; margin-left: 10px; border: 1px solid var(--blue); }
        .history-btn-top { background: var(--card); border: 1px solid #334155; color: white; padding: 10px 15px; border-radius: 10px; cursor: pointer; font-size: 13px; }

        .page { display: none; padding: 15px; padding-bottom: 120px; }
        .active-page { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Ú©Ø§Ø±Øª Ø³ÛŒÚ¯Ù†Ø§Ù„ */
        .signal-card { padding: 15px; margin-bottom: 15px; border-right: 5px solid var(--blue); position: relative; }
        .pnl-badge { position: absolute; left: 15px; top: 15px; font-weight: bold; font-size: 16px; }
        .buy { border-right-color: var(--green); }
        .sell { border-right-color: var(--red); }

        /* Ù†ÙˆØ§Ø± Ù†Ø§ÙˆØ¨Ø±ÛŒ Ù¾Ø§ÛŒÛŒÙ† */
        .nav-container { position: fixed; bottom: 0; left: 0; right: 0; background: #0f172a; display: flex; padding: 10px 0; border-top: 1px solid #334155; z-index: 9999; }
        .nav-item { flex: 1; background: none; border: none; color: #64748b; display: flex; flex-direction: column; align-items: center; font-size: 10px; cursor: pointer; transition: 0.2s; }
        .nav-item.active { color: var(--blue); transform: translateY(-2px); }
        .nav-item i { font-size: 22px; margin-bottom: 4px; }

        .hist-row { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 13px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid #334155; background: #000; color: white; box-sizing: border-box; }
        .main-btn { width: 100%; padding: 15px; background: var(--blue); border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div class="top-bar glass">
        <div class="total-box">
            <small style="color:#94a3b8">Ø¨Ø±Ø¢ÛŒÙ†Ø¯ Ú©Ù„ (Pip)</small><br>
            <b id="total-pips" style="font-size: 24px;">0</b>
        </div>
        <button class="history-btn-top" onclick="tab('p-history')">ðŸ“œ ØªØ§Ø±ÛŒØ®Ú†Ù‡</button>
    </div>

    <div id="p-signals" class="page active-page">
        <div id="signal-list"></div>
    </div>

    <div id="p-history" class="page">
        <h3>ðŸ“œ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù‡</h3>
        <div id="history-list" class="glass"></div>
    </div>

    <div id="p-copy" class="page">
        <h3>ðŸ”„ Ú©Ù¾ÛŒâ€ŒØªØ±ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±</h3>
        <div class="glass" style="padding:15px;">
            <p style="font-size:12px; color:#94a3b8">Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ù…Ø³ØªØ± Ø¬Ù‡Øª Ú©Ù¾ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±:</p>
            <input type="text" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ø­Ø³Ø§Ø¨ MT5">
            <input type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
            <input type="text" placeholder="Ù†Ø§Ù… Ø³Ø±ÙˆØ±">
            <button class="main-btn">Ø§ØªØµØ§Ù„ Ø¢Ù†ÛŒ</button>
        </div>
    </div>

    <div id="p-calc" class="page">
        <h3>ðŸ§® Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±Ù…Ø§ÛŒÙ‡</h3>
        <div class="glass" style="padding:15px;">
            <input type="number" id="bal" placeholder="Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø­Ø³Ø§Ø¨ ($)">
            <input type="number" id="sl_p" placeholder="Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ (Ù¾ÛŒÙ¾)">
            <button class="main-btn" onclick="calculateLot()" style="background:var(--green)">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¬Ù…</button>
            <h2 id="calc-res" style="text-align:center; color:var(--green)"></h2>
        </div>
    </div>

    <nav class="nav-container">
        <button class="nav-item active" onclick="tab('p-signals', this)"><i>ðŸ“ˆ</i><span>Ø³ÛŒÚ¯Ù†Ø§Ù„</span></button>
        <button class="nav-item" onclick="tab('p-copy', this)"><i>ðŸ”„</i><span>Ú©Ù¾ÛŒâ€ŒØªØ±ÛŒØ¯</span></button>
        <button class="nav-item" onclick="tab('p-history', this)"><i>ðŸ“œ</i><span>ØªØ§Ø±ÛŒØ®Ú†Ù‡</span></button>
        <button class="nav-item" onclick="tab('p-calc', this)"><i>ðŸ§®</i><span>Ù…Ø­Ø§Ø³Ø¨Ù‡</span></button>
        <button class="nav-item" onclick="openSupport()"><i>ðŸŽ§</i><span>Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</span></button>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        function tab(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            
            document.getElementById(id).classList.add('active-page');
            
            if(el) {
                el.classList.add('active');
            } else {
                // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ù…ØªÙ†Ø§Ø¸Ø± Ø¯Ø± Ù†ÙˆØ§Ø± Ù¾Ø§ÛŒÛŒÙ† Ø¨Ø± Ø§Ø³Ø§Ø³ ID ØµÙØ­Ù‡
                const map = {'p-signals':0, 'p-copy':1, 'p-history':2, 'p-calc':3};
                const idx = map[id];
                if(idx !== undefined) document.querySelectorAll('.nav-item')[idx].classList.add('active');
            }
        }

        function openSupport() {
            tg.openTelegramLink('https://t.me/your_admin_username');
        }

        function calculateLot() {
            const b = document.getElementById('bal').value;
            const s = document.getElementById('sl_p').value;
            if(b && s) {
                const res = (b * 0.01) / (s * 10);
                document.getElementById('calc-res').innerText = res.toFixed(2) + " Lot";
            }
        }

        async function update() {
            try {
                const r = await fetch('http://localhost:8000/api/v1/status');
                const d = await r.json();
                
                document.getElementById('total-pips').innerText = Math.round(d.total_pips);

                let sHtml = '';
                d.active_signals.forEach(s => {
                    const color = s.current_pips >= 0 ? 'var(--green)' : 'var(--red)';
                    sHtml += `
                        <div class="glass signal-card ${s.type=='BUY'?'buy':'sell'}">
                            <div class="pnl-badge" style="color:${color}">${s.current_pips > 0 ? '+':''}${Math.round(s.current_pips)} P</div>
                            <div style="font-size:18px; font-weight:bold;">${s.symbol}</div>
                            <div style="font-size:12px; color:#94a3b8; margin-top:10px;">
                                Ù†ÙˆØ¹: <b style="color:white">${s.type}</b> | ÙˆØ±ÙˆØ¯: <b style="color:white">${s.entry}</b> | Ø²Ù…Ø§Ù†: <b style="color:white">${s.time}</b>
                            </div>
                        </div>`;
                });
                document.getElementById('signal-list').innerHTML = sHtml || '<center style="margin-top:20px; opacity:0.5">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø³ÛŒÚ¯Ù†Ø§Ù„...</center>';

                let hHtml = '';
                d.history.forEach(h => {
                    hHtml += `
                        <div class="hist-row">
                            <span><b>${h.symbol}</b> <small>${h.time}</small></span>
                            <b style="color:${h.pips>=0?'var(--green)':'var(--red)'}">${h.pips > 0 ? '+':''}${Math.round(h.pips)} Pip</b>
                        </div>`;
                });
                document.getElementById('history-list').innerHTML = hHtml || '<p style="padding:15px">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª</p>';
            } catch(e) {}
        }

        setInterval(update, 2000);
        update();
    </script>
</body>
</html>
