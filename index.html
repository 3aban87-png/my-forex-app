<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TERMINAL PRO</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #050810; --card: rgba(30, 41, 59, 0.6); --blue: #3b82f6; --green: #10b981; --red: #ef4444; --text: #f8fafc; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: sans-serif; }
        .glass { background: var(--card); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; margin: 10px; padding: 15px; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; }
        .signal-card { position: relative; border-right: 4px solid var(--blue); margin-bottom: 10px; }
        .pnl { position: absolute; left: 15px; top: 15px; font-size: 18px; font-weight: bold; }
        .sltp-box { display: flex; gap: 10px; margin-top: 10px; font-size: 11px; opacity: 0.8; }
        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #0f172a; padding: 10px 0; border-top: 1px solid #334155; }
        .nav-btn { flex: 1; border: none; background: none; color: #64748b; font-size: 10px; }
        .nav-btn.active { color: var(--blue); }
        .page { display: none; padding-bottom: 80px; }
        .active-page { display: block; }
    </style>
</head>
<body>

    <div class="top-bar glass">
        <div><small>Ø¨Ø±Ø¢ÛŒÙ†Ø¯ Ú©Ù„</small><br><b id="total" style="font-size:22px">0</b> Pip</div>
        <button onclick="tab('p-hist')" style="background:none; border:1px solid #444; color:white; border-radius:8px; padding:5px 10px;">ğŸ“œ ØªØ§Ø±ÛŒØ®Ú†Ù‡</button>
    </div>

    <div id="p-sig" class="page active-page"><div id="list-sig"></div></div>
    <div id="p-news" class="page"><h3>ğŸ“¢ Ø§Ø®Ø¨Ø§Ø± Ø¨Ø§Ø²Ø§Ø±</h3><div id="list-news"></div></div>
    <div id="p-hist" class="page"><h3>ğŸ“œ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù‡</h3><div id="list-hist"></div></div>

    <nav class="nav">
        <button class="nav-btn active" onclick="tab('p-sig', this)">ğŸ“ˆ Ø³ÛŒÚ¯Ù†Ø§Ù„</button>
        <button class="nav-btn" onclick="tab('p-news', this)">ğŸ“¢ Ø§Ø®Ø¨Ø§Ø±</button>
        <button class="nav-btn" onclick="tab('p-hist', this)">ğŸ“œ ØªØ§Ø±ÛŒØ®Ú†Ù‡</button>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // Ø¢Ø¯Ø±Ø³ IP Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ± Ø´Ù…Ø§ (Ù…Ø«Ø§Ù„: 192.168.1.5) - Ø¨Ø§ Ø¯Ø³ØªÙˆØ± ipconfig Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒØ¯
        const API = "http://192.168.1.6:8000"; 

        function tab(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active-page');
            if(el) el.classList.add('active');
        }

        async function refresh() {
            try {
                const res = await fetch(`${API}/api/v1/status`);
                const data = await res.json();
                
                document.getElementById('total').innerText = Math.round(data.total_pips);

                let h = '';
                data.active_signals.forEach(s => {
                    const c = s.current_pips >= 0 ? 'var(--green)' : 'var(--red)';
                    h += `<div class="glass signal-card">
                        <div class="pnl" style="color:${c}">${Math.round(s.current_pips)} P</div>
                        <b>${s.symbol}</b> <small>${s.type}</small><br>
                        <small>Entry: ${s.entry}</small>
                        <div class="sltp-box">
                            <span style="color:var(--red)">SL: ${s.sl || '---'}</span>
                            <span style="color:var(--green)">TP: ${s.tp || '---'}</span>
                        </div>
                    </div>`;
                });
                document.getElementById('list-sig').innerHTML = h || '<center>Ø³ÛŒÚ¯Ù†Ø§Ù„ ÙØ¹Ø§Ù„ÛŒ Ù†ÛŒØ³Øª</center>';
                
                let n = '';
                data.news.forEach(news => {
                    n += `<div class="glass"><b>${news.time}</b><br>${news.title}</div>`;
                });
                document.getElementById('list-news').innerHTML = n;
            } catch(e) { console.error("Server Link Error"); }
        }

        setInterval(refresh, 2500); refresh();
    </script>
</body>
</html>
