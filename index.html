<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EXPONENTIAL FX TERMINAL</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #0f172a; --card: #1e293b; --blue: #3b82f6; --green: #10b981; --red: #ef4444; --text: #f8fafc;
        }

        body {
            margin: 0; padding: 0; background: var(--bg); color: var(--text);
            font-family: 'Tahoma', sans-serif; padding-bottom: 120px;
        }

        /* Ù†ÙˆØ§Ø± Ø¢Ù…Ø§Ø± Ø¨Ø§Ù„Ø§ */
        .stats-header {
            background: linear-gradient(to bottom, #1e293b, #0f172a);
            padding: 20px; text-align: center; border-bottom: 2px solid var(--blue);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ ØµÙØ­Ø§Øª */
        .page { display: none; padding: 15px; }
        .active-page { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ùˆ Ø¨Ø®Ø´â€ŒÙ‡Ø§ */
        .card {
            background: var(--card); border-radius: 15px; padding: 15px;
            margin-bottom: 15px; border: 1px solid #334155;
        }

        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ø§ÙˆØ¨Ø±ÛŒ Ø¨Ø²Ø±Ú¯ (Ø§ØµÙ„Ø§Ø­ Ø§ØµÙ„ÛŒ) */
        .nav-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: #1e293b; display: flex; height: 80px;
            border-top: 2px solid var(--blue); z-index: 9999;
        }

        .nav-btn {
            flex: 1; background: none; border: none; color: #94a3b8;
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; cursor: pointer; transition: 0.2s;
            font-size: 11px; font-weight: bold; -webkit-tap-highlight-color: transparent;
        }

        .nav-btn span { font-size: 24px; margin-bottom: 5px; } /* Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯ */
        .nav-btn.active { background: rgba(59, 130, 246, 0.1); color: var(--blue); }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ù„ÛŒØ³Øªâ€ŒÙ‡Ø§ */
        .hist-item {
            background: rgba(255,255,255,0.05); padding: 12px;
            border-radius: 10px; margin-bottom: 8px; display: flex;
            justify-content: space-between; align-items: center;
        }

        input {
            width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px;
            border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box;
        }
    </style>
</head>
<body>

    <div class="stats-header">
        <div style="font-size: 12px; color: #94a3b8;">Ø¨Ø±Ø¢ÛŒÙ†Ø¯ Ú©Ù„ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</div>
        <div id="total-pips" style="font-size: 28px; font-weight: bold; color: var(--green);">0.0</div>
    </div>

    <div id="p-signals" class="page active-page">
        <h3 style="border-right: 4px solid var(--blue); padding-right: 10px;">ğŸ“ˆ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù„Ø§ÛŒÙˆ</h3>
        <div id="signal-list"></div>
    </div>

    <div id="p-history" class="page">
        <h3>ğŸ“œ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3>
        <div id="history-list"></div>
    </div>

    <div id="p-copy" class="page">
        <div class="card">
            <h3>ğŸ”„ Ú©Ù¾ÛŒâ€ŒØªØ±ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±</h3>
            <p style="font-size: 13px; color: #94a3b8;">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ø³Ø§Ø¨ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ù…Ø³ØªØ± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:</p>
            <input type="text" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ø­Ø³Ø§Ø¨ (MT5)">
            <input type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
            <input type="text" placeholder="Ù†Ø§Ù… Ø³Ø±ÙˆØ± (Broker Server)">
            <button style="width:100%; padding:15px; background:var(--blue); border:none; border-radius:10px; color:white; font-weight:bold; margin-top:10px;">Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø§ØªØµØ§Ù„</button>
        </div>
    </div>

    <div id="p-calc" class="page">
        <div class="card">
            <h3>ğŸ§® Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±Ù…Ø§ÛŒÙ‡</h3>
            <input type="number" id="bal" placeholder="Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø­Ø³Ø§Ø¨ ($)">
            <input type="number" id="rsk" placeholder="Ø¯Ø±ØµØ¯ Ø±ÛŒØ³Ú© (Ù…Ø«Ù„Ø§Ù‹ 1)">
            <input type="number" id="sl_p" placeholder="Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ (Ù¾ÛŒÙ¾)">
            <button onclick="calculate()" style="width:100%; padding:15px; background:var(--green); border:none; border-radius:10px; color:white; font-weight:bold;">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¬Ù… (Lot)</button>
            <h2 id="res" style="text-align:center; color:var(--green)"></h2>
        </div>
    </div>

    <nav class="nav-bar">
        <button class="nav-btn" onclick="showTab('p-signals', this)"><span>ğŸ“ˆ</span>Ø³ÛŒÚ¯Ù†Ø§Ù„</button>
        <button class="nav-btn" onclick="showTab('p-history', this)"><span>ğŸ“œ</span>ØªØ§Ø±ÛŒØ®Ú†Ù‡</button>
        <button class="nav-btn" onclick="showTab('p-copy', this)"><span>ğŸ”„</span>Ú©Ù¾ÛŒâ€ŒØªØ±ÛŒØ¯</button>
        <button class="nav-btn" onclick="showTab('p-calc', this)"><span>ğŸ§®</span>Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
        <button class="nav-btn" onclick="window.open('https://t.me/your_admin')"><span>ğŸ§</span>Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</button>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // ØªØ§Ø¨Ø¹ ØªØ¹ÙˆÛŒØ¶ ØªØ¨â€ŒÙ‡Ø§ Ø¨Ø§ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¨Ø§Ù„Ø§
        function showTab(pageId, btn) {
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ
            const target = document.getElementById(pageId);
            if(target) {
                target.classList.add('active-page');
            }
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡
            if(btn) {
                btn.classList.add('active');
            }
        }

        function calculate() {
            const b = document.getElementById('bal').value;
            const r = document.getElementById('rsk').value;
            const s = document.getElementById('sl_p').value;
            if(b && r && s) {
                const lot = (b * (r/100)) / (s * 10);
                document.getElementById('res').innerText = lot.toFixed(2) + " Lot";
            }
        }

        async function update() {
            try {
                // Ø¢Ø¯Ø±Ø³ Ø³Ø±ÙˆØ± Ù¾Ø§ÛŒØªÙˆÙ† Ø´Ù…Ø§
                const res = await fetch('http://localhost:8000/api/v1/status');
                const data = await res.json();
                
                document.getElementById('total-pips').innerText = (data.total_pips > 0 ? "+" : "") + data.total_pips;

                // Ø±Ù†Ø¯Ø± Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§
                const sList = document.getElementById('signal-list');
                sList.innerHTML = data.active_signals.length ? "" : '<p style="text-align:center; color:#64748b; margin-top:30px;">Ø³ÛŒÚ¯Ù†Ø§Ù„ ÙØ¹Ø§Ù„ÛŒ Ù†ÛŒØ³Øª</p>';
                data.active_signals.forEach(s => {
                    sList.innerHTML += `
                        <div class="card" style="border-right: 5px solid ${s.type=='BUY'?'var(--green)':'var(--red)'}">
                            <div style="display:flex; justify-content:space-between;">
                                <b>ğŸ“Š ${s.symbol}</b>
                                <b style="color:${s.type=='BUY'?'var(--green)':'var(--red)'}">${s.type}</b>
                            </div>
                            <div style="font-size:12px; margin-top:10px; display:grid; grid-template-columns:1fr 1fr; gap:5px;">
                                <span>ÙˆØ±ÙˆØ¯: ${s.entry}</span>
                                <span>Ø²Ù…Ø§Ù†: ${s.time.split(' ')[1]}</span>
                                <span style="color:var(--red)">SL: ${s.sl}</span>
                                <span style="color:var(--green)">TP: ${s.tp}</span>
                            </div>
                        </div>`;
                });

                // Ø±Ù†Ø¯Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡
                const hList = document.getElementById('history-list');
                hList.innerHTML = "";
                data.history.forEach(h => {
                    hList.innerHTML += `
                        <div class="hist-item">
                            <span>${h.symbol}</span>
                            <b style="color:${h.pips>=0?'var(--green)':'var(--red)'}">${h.pips > 0 ? '+':''}${h.pips} Pip</b>
                        </div>`;
                });
            } catch(e) { console.log("Waiting for Server..."); }
        }

        setInterval(update, 3000);
        update();
    </script>
</body>
</html>
