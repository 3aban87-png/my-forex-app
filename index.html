<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PRO TERMINAL</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --blue: #3b82f6; --green: #10b981; --red: #ef4444; --text: #f8fafc; }
        body { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: sans-serif; padding-bottom: 100px; overflow-x: hidden; }
        
        .header { background: #1e293b; padding: 20px; text-align: center; border-bottom: 2px solid var(--blue); }
        .page { display: none; padding: 15px; animation: fadeIn 0.2s; }
        .active-page { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 15px; border: 1px solid #334155; }
        
        /* Ù†ÙˆØ§Ø± Ù†Ø§ÙˆØ¨Ø±ÛŒ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯Ø³Ú©ØªØ§Ù¾ */
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #1e293b; display: flex; height: 75px; border-top: 1px solid var(--blue); z-index: 10000; justify-content: space-around; }
        .nav-btn { flex: 1; background: none; border: none; color: #94a3b8; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; font-size: 11px; outline: none; }
        .nav-btn b { font-size: 20px; margin-bottom: 4px; display: block; }
        .nav-btn.active { color: var(--blue); background: rgba(59, 130, 246, 0.1); }

        .hist-item { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; margin-bottom: 5px; display: flex; justify-content: space-between; }
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; }
    </style>
</head>
<body>

    <div class="header">
        <div style="font-size: 11px; color: #94a3b8;">Ø¨Ø±Ø¢ÛŒÙ†Ø¯ Ú©Ù„ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</div>
        <div id="total-pips" style="font-size: 26px; font-weight: bold; color: var(--green);">0.0</div>
    </div>

    <div id="p-signals" class="page active-page">
        <h3>ğŸ“ˆ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ</h3>
        <div id="signal-list"></div>
    </div>

    <div id="p-history" class="page">
        <h3>ğŸ“œ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3>
        <div id="history-list"></div>
    </div>

    <div id="p-copy" class="page">
        <div class="card">
            <h3>ğŸ”„ Ú©Ù¾ÛŒâ€ŒØªØ±ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±</h3>
            <input type="text" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ø­Ø³Ø§Ø¨">
            <input type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
            <button style="width:100%; padding:12px; background:var(--blue); border:none; border-radius:8px; color:white;">Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±</button>
        </div>
    </div>

    <div id="p-calc" class="page">
        <div class="card">
            <h3>ğŸ§® Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¬Ù…</h3>
            <input type="number" id="bal" placeholder="Ù…ÙˆØ¬ÙˆØ¯ÛŒ ($)">
            <input type="number" id="sl_p" placeholder="Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ (Ù¾ÛŒÙ¾)">
            <button onclick="calculate()" style="width:100%; padding:12px; background:var(--green); border:none; border-radius:8px; color:white;">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
            <h2 id="res" style="text-align:center;"></h2>
        </div>
    </div>

    <div id="p-news" class="page">
        <h3>ğŸ“¢ Ø§Ø®Ø¨Ø§Ø± Ùˆ Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡â€ŒÙ‡Ø§</h3>
        <div class="card">Ø³ÛŒØ³ØªÙ… Ø¨Ù‡ Ù†Ø³Ø®Ù‡ Ù¾Ø±Ùˆ Ø¢Ù¾Ø¯ÛŒØª Ø´Ø¯.</div>
    </div>

    <nav class="nav-bar">
        <div class="nav-btn active" id="btn-signals"><b>ğŸ“ˆ</b><span>Ø³ÛŒÚ¯Ù†Ø§Ù„</span></div>
        <div class="nav-btn" id="btn-history"><b>ğŸ“œ</b><span>ØªØ§Ø±ÛŒØ®Ú†Ù‡</span></div>
        <div class="nav-btn" id="btn-copy"><b>ğŸ”„</b><span>Ú©Ù¾ÛŒâ€ŒØªØ±ÛŒØ¯</span></div>
        <div class="nav-btn" id="btn-calc"><b>ğŸ§®</b><span>Ù…Ø­Ø§Ø³Ø¨Ù‡</span></div>
        <div class="nav-btn" id="btn-news"><b>ğŸ“¢</b><span>Ø§Ø®Ø¨Ø§Ø±</span></div>
        <div class="nav-btn" id="btn-supp"><b>ğŸ§</b><span>Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</span></div>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // Ø³ÛŒØ³ØªÙ… Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ ØµÙØ­Ø§Øª Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯Ø³Ú©ØªØ§Ù¾ Ùˆ Ù…ÙˆØ¨Ø§ÛŒÙ„
        function setupNav() {
            const buttons = {
                'btn-signals': 'p-signals',
                'btn-history': 'p-history',
                'btn-copy': 'p-copy',
                'btn-calc': 'p-calc',
                'btn-news': 'p-news'
            };

            Object.keys(buttons).forEach(btnId => {
                document.getElementById(btnId).addEventListener('click', function() {
                    // Ø­Ø°Ù ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ø§Ù„ Ø§Ø² Ù‡Ù…Ù‡
                    document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    
                    // ÙØ¹Ø§Ù„ Ø³Ø§Ø²ÛŒ ØµÙØ­Ù‡ Ùˆ Ø¯Ú©Ù…Ù‡ Ø¬Ø¯ÛŒØ¯
                    document.getElementById(buttons[btnId]).classList.add('active-page');
                    this.classList.add('active');
                });
            });

            // Ø¯Ú©Ù…Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ
            document.getElementById('btn-supp').addEventListener('click', function() {
                tg.openTelegramLink('https://t.me/Your_Username'); // ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø®ÙˆØ¯Øª Ø±Ùˆ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø²Ù†
            });
        }

        function calculate() {
            const b = document.getElementById('bal').value;
            const s = document.getElementById('sl_p').value;
            if(b && s) {
                const lot = (b * 0.01) / (s * 10);
                document.getElementById('res').innerText = lot.toFixed(2) + " Lot";
            }
        }

        async function update() {
            try {
                const res = await fetch('http://localhost:8000/api/v1/status');
                const data = await res.json();
                document.getElementById('total-pips').innerText = data.total_pips;

                let sHtml = '';
                data.active_signals.forEach(s => {
                    sHtml += `<div class="card" style="border-right:5px solid ${s.type=='BUY'?'#10b981':'#ef4444'}">
                        <b>${s.symbol} | ${s.type}</b><br><small>ÙˆØ±ÙˆØ¯: ${s.entry}</small></div>`;
                });
                document.getElementById('signal-list').innerHTML = sHtml || 'Ø³ÛŒÚ¯Ù†Ø§Ù„ ÙØ¹Ø§Ù„ÛŒ Ù†ÛŒØ³Øª';

                let hHtml = '';
                data.history.forEach(h => {
                    hHtml += `<div class="hist-item"><span>${h.symbol}</span><b>${h.pips:+}</b></div>`;
                });
                document.getElementById('history-list').innerHTML = hHtml || 'ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª';
            } catch(e) {}
        }

        setupNav();
        setInterval(update, 3000);
        update();
    </script>
</body>
</html>
